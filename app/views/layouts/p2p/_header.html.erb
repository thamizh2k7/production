  <%= stylesheet_link_tag '/assets/p2p/header' %>

  <%#= request.env["HTTP_REFERER"]  %>

<div id="header" class="row">
  <div class="span2"><a href="/p2p"><img src="/assets/p2p/index/p2p_logo.png" alt="Logo" ></a></div>
  <div class="span4">
    <div class="input-append input-prepend">
        <span class="add-on " id="head_user_location"  cityid="<%= (session.has_key?(:city_id)) ? session[:city_id] : "" %>" > 

            <i class="icon-globe action_icon " data-placement="bottom" data-title="<%= (session.has_key?(:city)) ? session[:city] : "Choose your location now" %>"></i>
        </span>

          <div class="modal hide fade" id="location_modal">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h3>Select your Location</h3>
            </div>
              <div class="modal-body">
              <p><%=select_tag "user_location" ,options_for_select( P2p::City.all.collect{|city|  [city.name,city.id]})%></p>
            </div>
            <div class="modal-footer">
              <a href="#" id="location_modal_save" class="btn btn-primary">Save changes</a>
            </div>
          </div>

      
      <input id="top_search_input" type="text" class="span4" autocomplete="off" placeholder="Search Peer to peer">
      <span class="add-on"><i class="icon-search"></i></span>
    </div>
  </div>
  <div class="span6" id="menuSet">
      <div class="navbar pull-right">
        <ul class="nav">

          <% unless current_user.nil? %>

          <% if params[:action] == 'index'  and params[:controller]== 'p2p/messages'%>
              <li class="head_active">
                <% unread_count = (p2p_current_user.nil?) ? 0 :  p2p_current_user.received_messages.inbox.unread.count %>



                <a href="/p2p/messages">
                  <div id="header_msg_count"> <%= unread_count if  unread_count > 0  %> </div>
                  <span class="pull-left" >Messages</span>
                </a>
              </li>

          <% else %>
              <li>
                <% unread_count = (p2p_current_user.nil?) ? 0 :  p2p_current_user.received_messages.inbox.unread.count %>
                <a href="/p2p/messages">
                  <div id="header_msg_count"> <%= unread_count if  unread_count > 0  %> </div>
                  <span class="pull-left" >Messages</span>
                </a>
              </li>

          <% end %>

          

          <% if params[:action] == 'dashboard' %>
            <li class="head_active">
              <a href="/p2p/dashboard">Dashboard</a></li>
          <% else %>
            <li><a href="/p2p/dashboard">Dashboard</a></li>
          <% end %>
          

          <% if params[:action] == 'new'  and params[:controller]== 'p2p/items'%>
            <li class="head_active"><a href="/p2p/sellitem">List New Item</a></li>
          <% else %>
            <li><a href="/p2p/sellitem">List New Item</a></li>
          <% end %>


          
          
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <%=current_user.name%><b class="caret"></b>
              </a>
              <ul class="dropdown-menu submenu">
                <li><a href="#">My Profile</a></li>
                <li><%= link_to "SignOut", destroy_user_session_url, :method => :delete %></li>
                
              </ul>
            </li>

            <% else %>
              <li>
                <!-- Button to trigger modal -->
                <a href="#head_login_modal" role="button" data-toggle="modal">Login</a>
                 
                <!-- Modal -->
                <div id="head_login_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="head_login_modalLabel" aria-hidden="true">
                <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                <h3 id="head_login_modalLabel">Login to P2P</h3>
                </div>
                <div class="modal-body">


                  <div id="login_box">
                    <%= render :template => "devise/sessions/new" %>
                  </div>

                  <div id="signup_box">
                    <%= render :template => "devise/sessions/new" %>
                  </div>

                  <div id="forgot_box">
                    <%= render :template => "devise/sessions/new" %>
                  </div>

                </div>

                <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
                <button class="btn btn-primary">Save changes</button>
                </div>
                </div>


              </li>
          <% end %>
        </ul>
      </div>
    </div>

</div>


<!-- set the container hidden to avoid a flash of unstyled content
when the page first loads -->
<div id="notificationcontainer" style="display:none">
 
    <!-- 
    Later on, you can choose which template to use by referring to the 
    ID assigned to each template.  Alternatively, you could refer
    to each template by index, so in this example, "basic-tempate" is
    index 0 and "advanced-template" is index 1.
    -->
    <div id="simple_notification">
        <a class="ui-notify-cross ui-notify-close" href="#">x</a>
        <h1><i class="action icon-envelope icon-white"></i> #{title}</h1>
        <p>#{text}</p>
    </div>

     <div id="new_message_notification">
        <a class="ui-notify-cross ui-notify-close" href="#">x</a>
        <h1><i class="action icon-envelope icon-white"></i> You have a new message from #{username}</h1>
        <p style="margin:10px;">#{msg}</p>
    </div>

     <div id="new_item_notification">
        <a class="ui-notify-cross ui-notify-close" href="#">x</a>
        <h1><i class="action icon-envelope icon-white"></i> You have a listed a new item #{title}</h1>
        <p style="margin:10px;">#{msg}</p>
    </div>
 

</div>
